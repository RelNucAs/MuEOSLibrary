# MuEOSLibrary

C++ class for implementation of general-purpose Equation of State of dense matter.

Here is the list of the different particle species that the class can account for:
  - **Baryons**<br>
  The EOS of baryons is interpolated on a 3D CompOSE table that includes only the contribution of baryons. The table must be downloaded from the CompOSE website (https://compose.obspm.fr/home) and reprocessed into HDF5 format using **PyCompOSE** (https://bitbucket.org/dradice/pycompose/).<br>
  
  - **Massive leptons (electron and muons)**<br>
  Massive leptons are treated as ideal Fermi gases at finite temperature in thermal equilirium, see *Bludman, S.A., & van Riper, K.A. 1977, ApJ, 212, 859* (https://ui.adsabs.harvard.edu/abs/1977ApJ...212..859B/abstract). To compute the leptonic EOS, one can interpolate on a pre-computed 2D table (that can be generated by the code itself) or perform directly the evaluation of the EOS quantites through the on-the-fly computation of the Generalized Fermi Functions (GFFs).

  - **Photons**<br>
  Photons are treated as an ideal Bose gas in thermal equilibrium with matter and with zero chemical potential. The photon EOS is implemented via the on-the-fly computation of the associated formulae.

  - **Neutrinos**<br>
  Neutrinos are treated as a massless Fermi gas in weak and thermal equilibrium with matter and radiation. The neutrinos EOS is implemented via the on-the-fly computation of the associated formulae. The neutrino contribution at equilibrium to the total additive quantities (e.g. internal energy, pressure, entropy etc.) must be added manually, so that 

## Preliminary steps
  - Place the HDF5 file containing the baryonic EOS table (must be PyCompOSE output, see description above about baryonic EOS) in the `eos_table/baryons/`  folder.
  - To compute the leptonic EOS through table interpolation, first generate the lepton EOS tables by running **`make lep_table`** in the parent directory.

## EOS class 
The general-purpose EOS of dense matter is implemented through the C++ class named **`EOS_assembled`**, whose definition can be found in `src/eos_species/eos_assembled.cpp`

The class can be initalized by calling the constrctor `EOS_assembled(const int id_eos, const bool el_bool, const bool mu_bool, std::string BarTableName)`, where `id_eos` is an index determining the way in which the leptonic EOS is computed (0: table interpolation, 1: on-the-fly calculation, see description above), `el_bool` (`mu_bool`) ia a boolean variable that can be set to switch on/off the inclusion of electrons (muons) and `BarTableName` is the name of the baryonic EOS table.

The EOS output is computed by calling the class member function `FullEOSOutput EOS_assembled::compute_full_EOS(double nb, double T, double *Y)`.<br>
The input parameters are the following:
  - `double nb` : baryon number density [fm-3]<br>
  - `double T`  : temperature [MeV]<br>
  - `double Y[2] = {Ye, Ym}` : electron and muon fractions [#/baryon]<br>

**Warning:** always check that the EOS is called in a thermodynamic point that falls within the boundaries of the input tables!

The EOS output is organized in the `FullEOSOutput` structure which contains the following fields (please note that chemical potentials are including the rest-mass contribution):
   - `double rho`                // Mass density [g/cm3]
   - `double nb`                 // Baryon number density [1/fm3]
   - `double T`                  // Temperature [MeV]
   - `double mb`                 // Baryon mass [MeV]
   - `double e`                  // Internal energy density [erg/cm3]
   - `double P`                  // Pressure [erg/cm3]
   - `double s`                  // Entropy per baryon [#/baryon]
   - `double chem_pot.mu_n`      // Neutron chemical potential [MeV]
   - `double chem_pot.mu_p`      // Proton chemical potential [MeV]
   - `double chem_pot.mu_e`      // Electron chemical potential [MeV]
   - `double chem_pot.mu_m`      // Muon chemical potential [MeV]
   - `double chem_pot.mu_nue`    // Electron neutrino chemical potential [MeV] 
   - `double chem_pot.mu_num`    // Muon neutrino chemical potential [MeV]
   - `double chem_pot.mu_nux`    // Tau neutrino chemical potential [MeV]
   - `double Y_part.yh`          // Heavy nuclei fraction [#/baryon]
   - `double Y_part.ya`          // Alpha particle fraction [#/baryon]
   - `double Y_part.yn`          // Neutron fraction [#/baryon]
   - `double Y_part.yp`          // Proton fraction [#/baryon]
   - `double Y_part.ye`          // Electron fraction [#/baryon]
   - `double Y_part.ym`          // Muon fraction [#/baryon]
   - `double Y_part.ynue`        // Electron neutrino fraction [#/baryon]
   - `double Y_part.yanue`       // Electron antineutrino fraction [#/baryon]
   - `double Y_part.ynum`        // Muon neutrino fraction [#/baryon]
   - `double Y_part.yanum`       // Muon antineutrino fraction [#/baryon]
   - `double Y_part.ynux`        // Tau (anti)neutrino fraction [#/baryon]
   - `double Y_part.yle`         // Net electronic lepton fraction [#/baryons] (yle = ye + ynue - yanue)
   - `double Y_part.ylm`         // Net muonic lepton fraction [#/baryon] (ylm = ym + ynum - yanum)
   - `double nuEOS.z_nue`        // Electron neutrino energy per baryon [MeV/baryon]
   - `double nuEOS.z_anue`       // Electron antineutrino energy per baryon [MeV/baryon]
   - `double nuEOS.z_num`        // Muon neutrino energy per baryon [MeV/baryon]
   - `double nuEOS.z_anum`       // Muon antineutrino energy per baryon [MeV/baryon]
   - `double nuEOS.z_nux`        // Tau (anti)neutrino energy per baryon [MeV/baryon]
   - `double nuEOS.z_tot`        // Total neutrino energy per baryon [MeV/baryon]
   - `double nuEOS.s_nue`        // Electron neutrino entropy per baryon [#/baryon]
   - `double nuEOS.s_anue`       // Electron antineutrino entropy per baryon [#/baryon]
   - `double nuEOS.s_num`        // Muon neutrino entropy per baryon [#/baryon]
   - `double nuEOS.s_anum`       // Muon antineutrino entropy per baryon [#/baryon]
   - `double nuEOS.s_nux`        // Tau (anti)neutrino entropy per baryon [#/baryon]
   - `double nuEOS.s_tot`        // Total neutrino entropy per baryon [#/baryon]

See `main.cpp` for an example on how to initialize the class and compute the full EOS output in a single thermodynamic point.

## Generating an output table: how to
Tables including the contributions to the EOS of all the species can be generated using "eos_table/generate_global_table.cpp". The legend describing the content and the units can be read from the first line of the table.

The contribution of muons can be eventually switched off by setting the boolean variable "with_mu = false" at the beginning of the file.

The input parameters are:
  - nb : number density [fm-3]
  - T  : temperature [MeV]
  - Yq : charge fraction (equal to electron fraction, Ye, if muons are not considered)<br>
  If muon contribution is active:
  - Ym : muon fraction (in this case Ye = Yq-Ym by charge neutrality, please note that if Ye < 0 the EOS is not computed and the code jumps to the following iterartion)

The input nb, T, Yq arrays are directly from the baryonic EOS table, in order to avoid to introduce uncertainties associated with the interpolation of the baryonic table. The first two arrays are uniformly spaced in log space, while the third one is uniform in lin space.
The input Ym array is uniformly log-spaced and can be adjusted by the user by acting on the boundaries, "ymmin" and "ymmax", and on the number of points, "n_ym".

If necessary, the user can generate a coarser table by incrementing the variables controlling the step size of the loop over the input arrays ("di" for "n_array", "dj" for "t_array", "dk" for "yq_array" and "dl" for ym_array"). 

To generate the table:
  - Compile the code by running "make global_table" in the parent directory
  - Execute the code by running "./eos_table/generate_global_table" (the output table will be saved in "eos_table/global/")
